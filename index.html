<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فوازير رمضان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }

        @keyframes floatMoon {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating-moon {
            animation: floatMoon 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .star {
            position: absolute;
            color: #FCD34D;
            animation: twinkle 2s ease-in-out infinite;
        }

        .option-correct {
            background-color: rgba(34, 197, 94, 0.2) !important;
            border-color: rgb(34, 197, 94) !important;
        }

        .option-wrong {
            background-color: rgba(239, 68, 68, 0.2) !important;
            border-color: rgb(239, 68, 68) !important;
        }

        .option-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        @keyframes scaleNumber {
            0% { transform: scale(1); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .countdown-number {
            animation: scaleNumber 1s ease-out;
        }

        .countdown-text {
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-900 to-indigo-950 min-h-screen">
    <!-- شريط التاريخ -->
    <div class="bg-white/5 backdrop-blur-sm border-b border-white/10 p-3 text-white text-center">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span id="day-name" class="text-blue-400"></span>
            </div>
            <div class="flex items-center gap-2">
                <span id="current-date" class="text-green-400"></span>
            </div>
        </div>
    </div>

    <!-- شاشة خارج وقت المسابقة -->
    <div id="out-of-time-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-yellow-400/20 rounded-3xl p-8 text-center">
                <i data-lucide="clock" class="w-16 h-16 mx-auto text-yellow-400 mb-4"></i>
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">المسابقة غير متاحة حالياً</h2>
                <p class="text-gray-300 mb-4">المسابقة متاحة يومياً من الساعة 11 مساءً حتى 4:30 صباحاً</p>
                <div id="time-message" class="text-green-400 text-lg mb-8"></div>
                <a href="leaderboard.html" class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white px-8 py-3 rounded-xl">
                    عرض نتائج المتصدرين
                </a>
            </div>
        </div>
    </div>

    <!-- شاشة المشاركة السابقة -->
    <div id="already-participated-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-red-400/20 rounded-3xl p-8 text-center">
                <i data-lucide="alert-circle" class="w-16 h-16 mx-auto text-red-400 mb-4"></i>
                <h2 class="text-2xl font-bold text-red-400 mb-4">لقد شاركت مسبقاً</h2>
                <p class="text-gray-300 mb-6">يمكنك المشاركة مرة واحدة فقط في اليوم</p>
                <a href="leaderboard.html" class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white px-8 py-3 rounded-xl">
                    عرض نتائج المتصدرين
                </a>
            </div>
        </div>
    </div>

    <!-- شاشة جاري التحميل -->
    <div id="loading-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-blue-400/20 rounded-3xl p-8 text-center">
                <div class="animate-spin w-16 h-16 mx-auto border-4 border-blue-400 border-t-transparent rounded-full mb-4"></div>
                <h2 class="text-2xl font-bold text-blue-400 mb-4">جاري التحميل</h2>
                <p class="text-gray-300 mb-6">يرجى الانتظار...</p>
            </div>
        </div>
    </div>

    <!-- شاشة البداية -->
    <div id="start-screen" class="hidden min-h-[calc(100vh-64px)] text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-green-400/20 rounded-3xl p-8">
                <div class="text-center space-y-6">
                    <div class="relative h-32">
                        <div class="floating-moon">
                            <i data-lucide="moon" class="w-20 h-20 mx-auto text-yellow-400"></i>
                        </div>
                        <div class="absolute bottom-0 w-full">
                            <i data-lucide="star" class="star w-4 h-4" style="left: calc(50% - 20px);"></i>
                            <i data-lucide="star" class="star w-4 h-4" style="left: 50%;"></i>
                            <i data-lucide="star" class="star w-4 h-4" style="left: calc(50% + 20px);"></i>
                        </div>
                    </div>
                    <h1 class="text-3xl font-bold text-yellow-400">فوازير رمضان</h1>
                    <div class="space-y-4">
                        <label class="text-lg block text-center mb-2">
                            أدخل اسمك للمشاركة في المسابقة
                        </label>
                        <input
                            type="text"
                            id="player-name"
                            placeholder="الاسم الكريم"
                            class="w-full bg-white/5 border-2 border-green-400/20 text-center text-lg py-6 rounded-xl text-white"
                        >
                        <input
                            type="email"
                            id="player-email"
                            placeholder="البريد الإلكتروني (اختياري)"
                            class="w-full bg-white/5 border-2 border-green-400/20 text-center text-lg py-6 rounded-xl text-white"
                        >
                    </div>
                    <button
                        id="start-button"
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-6 rounded-xl text-lg flex items-center justify-center gap-2"
                        disabled
                    >
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        بدء المسابقة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة العد التنازلي -->
    <div id="countdown-screen" class="fixed inset-0 bg-blue-900/95 backdrop-blur-sm hidden z-50 flex items-center justify-center">
        <div class="text-center">
            <div id="countdown-number" class="text-8xl font-bold text-yellow-400 mb-4 countdown-number"></div>
            <div id="countdown-text" class="text-2xl text-white countdown-text"></div>
        </div>
    </div>

    <!-- شاشة الأسئلة -->
    <div id="quiz-screen" class="min-h-screen text-white p-6 hidden">
        <div class="max-w-3xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-yellow-400 mb-2">فوازير رمضان</h1>
                <p id="player-welcome" class="text-lg text-green-400"></p>
            </div>
            <div class="bg-white/10 backdrop-blur-lg border-2 border-green-400/20 rounded-2xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <i data-lucide="clock" class="w-5 h-5"></i>
                        <span id="timer" class="text-xl font-bold">10</span>
                    </div>
                    <div id="question-counter" class="text-lg"></div>
                </div>
                <div class="relative h-2 bg-gray-700/50 rounded-full overflow-hidden mb-6">
                    <div id="timer-bar" class="absolute top-0 left-0 h-full bg-green-400 transition-all duration-1000"></div>
                </div>
                <h3 id="question-text" class="text-xl font-semibold mb-6 pr-4 border-r-4 border-green-400"></h3>
                <div id="options-container" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- شاشة النتائج -->
    <div id="results-screen" class="min-h-screen text-white p-6 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-yellow-400/30 rounded-2xl p-8">
                <i data-lucide="trophy" class="w-16 h-16 mx-auto text-yellow-400 mb-4"></i>
                <h3 class="text-2xl font-bold text-yellow-400 mb-4 text-center">النتيجة النهائية</h3>
                <p id="final-name" class="text-xl mb-4 text-center"></p>
                <p id="final-score" class="text-xl mb-6 text-center"></p>
                <div id="answers-review" class="space-y-4 mt-8"></div>
                <div class="flex gap-4 mt-6">
                    <button onclick="location.reload()" class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-4 rounded-xl text-lg">
                        حاول مرة أخرى
                    </button>
                    <button onclick="window.location.href='leaderboard.html'" class="flex-1 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white py-4 rounded-xl text-lg">
                        قائمة المتصدرين
                    </button>
                </div>
            </div>
        </div>
    </div>
<script>
// تهيئة Firebase
const firebaseConfig = {
    apiKey: "AIzaSyC5RYK1lGaJaMQJmOH85cqNgv6m7rbLS_A",
    authDomain: "ramadanmotaz-5570f.firebaseapp.com",
    projectId: "ramadanmotaz-5570f",
    storageBucket: "ramadanmotaz-5570f.appspot.com",
    messagingSenderId: "595667154066",
    appId: "1:595667154066:web:80ba616566ec55a5efe24b",
    measurementId: "G-WLVRQVRGHT"
};

let db;

// إعدادات المسابقة
const QUIZ_MODE = "always"; // "always", "auto", "never"
const QUIZ_START_HOUR = 23;    // 11 مساءً
const QUIZ_START_MINUTE = 0;   // 00 دقيقة
const QUIZ_END_HOUR = 4;       // 4 صباحاً
const QUIZ_END_MINUTE = 30;    // 30 دقيقة

// تهيئة Firebase
async function initializeFirebase() {
    try {
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();
        console.log('تم تهيئة Firebase بنجاح');
        return true;
    } catch (error) {
        console.error('خطأ في تهيئة Firebase:', error);
        return false;
    }
}

// بنك الأسئلة
const ramadanQuestions = {
                15: [ // اليوم 15 من رمضان
                {
                    question: "ما هي السورة التي نزلت في ليلة النصف من رمضان؟",
                    options: ["سورة الدخان", "سورة القدر", "سورة البقرة", "سورة يس"],
                    correct: 0
                },
                {
                    question: "كم عدد الركعات في صلاة التراويح التي كان يصليها النبي ﷺ؟",
                    options: ["8 ركعات", "11 ركعة", "20 ركعة", "23 ركعة"],
                    correct: 1
                },
                {
                    question: "ما هو دعاء النصف من رمضان المأثور؟",
                    options: [
                        "اللهم اغفر لي ذنوبي",
                        "اللهم إنك عفو تحب العفو فاعف عني",
                        "اللهم بلغنا رمضان",
                        "اللهم تقبل منا صيامنا"
                    ],
                    correct: 1
                },
                {
                    question: "ما هي العبادة التي تُستحب في النصف الثاني من رمضان؟",
                    options: [
                        "الاعتكاف",
                        "صيام النوافل",
                        "صلاة الضحى",
                        "قيام الليل"
                    ],
                    correct: 0
                },
                {
                    question: "كم مرة ختم النبي ﷺ القرآن في رمضان مع جبريل عليه السلام؟",
                    options: ["مرة واحدة", "مرتين", "ثلاث مرات", "أربع مرات"],
                    correct: 1
                }
            ],
            16: [ // اليوم 16 من رمضان
                {
                    question: "متى كانت غزوة بدر الكبرى؟",
                    options: ["17 رمضان السنة الثانية للهجرة", "15 رمضان السنة الثالثة للهجرة", "20 رمضان السنة الأولى للهجرة", "10 رمضان السنة الرابعة للهجرة"],
                    correct: 0
                },
                {
                    question: "من هو الصحابي الذي كان أول مؤذن في الإسلام؟",
                    options: ["بلال بن رباح", "عبدالله بن مسعود", "سعد بن أبي وقاص", "عمر بن الخطاب"],
                    correct: 0
                },
                {
                    question: "ما هي الصلاة التي تؤدى بعد صلاة العشاء في رمضان؟",
                    options: ["قيام الليل", "التهجد", "التراويح", "الوتر"],
                    correct: 2
                },
                {
                    question: "ما هي أول غزوة قادها النبي ﷺ بنفسه؟",
                    options: ["غزوة الخندق", "غزوة بدر", "غزوة أحد", "غزوة تبوك"],
                    correct: 1
                },
                {
                    question: "من هو الصحابي الذي اشتهر بلقب «الفاروق»؟",
                    options: ["علي بن أبي طالب", "عمر بن الخطاب", "عثمان بن عفان", "أبو بكر الصديق"],
                    correct: 1
                }
            ],
            17: [ // اليوم 17 من رمضان
                {
                    question: "ما هو الشهر الذي نزل فيه القرآن الكريم؟",
                    options: ["شعبان", "رجب", "رمضان", "ذو القعدة"],
                    correct: 2
                },
                {
                    question: "ما هي الليلة التي يُرجى أن تكون ليلة القدر؟",
                    options: ["منتصف رمضان", "أول ليلة من رمضان", "الليالي الوترية من العشر الأواخر", "ليلة 15 رمضان"],
                    correct: 2
                },
                {
                    question: "من هو الصحابي الذي أمره النبي ﷺ بالآذان في رمضان؟",
                    options: ["بلال بن رباح", "عبدالله بن أم مكتوم", "أبو هريرة", "عبدالله بن مسعود"],
                    correct: 0
                },
                {
                    question: "كم مرة ذكر اسم رمضان في القرآن الكريم؟",
                    options: ["مرة واحدة", "مرتين", "ثلاث مرات", "أربع مرات"],
                    correct: 0
                },
                {
                    question: "متى كانت الهجرة النبوية؟",
                    options: ["السنة العاشرة للبعثة", "السنة الثانية للبعثة", "السنة الثالثة عشرة للبعثة", "السنة الخامسة للبعثة"],
                    correct: 2
                }
            ],
            18: [ // اليوم 18 من رمضان
                {
                    question: "من هو أول الخلفاء الراشدين؟",
                    options: ["عثمان بن عفان", "عمر بن الخطاب", "علي بن أبي طالب", "أبو بكر الصديق"],
                    correct: 3
                },
                {
                    question: "في أي هجرة بدأ النبي محمد صلى الله عليه وسلم الانتقال من مكة إلى المدينة؟",
                    options: ["هجرة 10 هـ", "هجرة 14 هـ", "هجرة 12 هـ", "هجرة 5 هـ"],
                    correct: 1
                },
                {
                    question: "ما هو الكتاب المقدس في الإسلام؟",
                    options: ["الإنجيل", "الزبور", "التوراة", "القرآن"],
                    correct: 3
                },
                {
                    question: "ما هي السورة التي تُعرف بسورة الإخلاص؟",
                    options: ["سورة الفلق", "سورة الناس", "سورة الإخلاص", "سورة الكوثر"],
                    correct: 2
                },
                {
                    question: "من هو النبي الذي ابتلعه الحوت ثم نجا بعد دعائه؟",
                    options: ["يونس", "موسى", "نوح", "عيسى"],
                    correct: 0
                }
            ],
            19: [ // اليوم 19 من رمضان
                {
                    question: "ما هي أول معركة في التاريخ الإسلامي؟",
                    options: ["الخندق", "أحد", "بدر", "حنين"],
                    correct: 2
                },
                {
                    question: "كم هي المدَّة التي استغرقها نزول القرآن الكريم؟ ",
                    options: ["عشر سنوات ", "احدى عشر سنه", "واحد وعشرين سنه", "ثلاث و عشرين سنه"],
                    correct: 3
                },
                {
                    question: "من هو الصحابي الذي ذكر اسمه صريحاً في القرآن الكريم؟",
                    options: ["علي بن أبي طالب", "خالد بن الوليد", "زيد بن حارثة", "عثمان بن عفان"],
                    correct: 2
                },
                {
                    question: "كم عدد السور المكية في القرآن الكريم؟",
                     options: ["إحدى عشر سورة", "خمس و ثمانون سورة", "عشر سور", "ست و ثمانون سورة "],
                    correct: 3
                },
                {
                    question: "من هي أول شهيدة في الإسلام؟ ",
                    options: [" مستورة بنت أبي سلمة", "نسيبة بنت كعب", "سمية بنت خياط ", "فاطمة الزهراء"],
                    correct: 2
                }
            ],
            20: [ // اليوم 20 من رمضان 
    {
        question: " ما أول هدية قُدمت للنبي صلى الله عليه وسلم في دار أبي أيوب؟ ",
        options: ["قصعة فيها خبز مثرود بلبن وسمن", "قصعة من العسل", "قصعة من الحساء", "قطعة من اللحم المشوي"],
        correct: 0
    },
    {
        question: "من الذي أراد هدم الكعبة في عام الفيل؟",
        options: ["النمرود", "أبو جهل", "أبرهة بن الصباح", "أبرهة الحبشي"],
        correct: 3
    },
    {
        question: "من الصحابيّ الجليل الذي نام في فراش النبيّ صلى الله عليه وسلم في ليلة الهجرة؟",
        options: ["عمر بن الخطاب", "علي بن أبي طالب", "أبو بكر الصديق", "عبد الله بن مسعود"],
        correct: 1
    },
    {
        question: "من الذي كان يأتي النبي صلى الله عليه وسلم وأبو بكر الصديق بالأخبار وهما في غار ثور؟",
        options: ["علي بن أبي طالب", "عبد الرحمن بن عوف", "عبد الله بن أبي بكر", "زيد بن حارثة"],
        correct: 2
    },
    {
        question: "من هم أصحاب الأعراف؟",
        options: ["قوم استوت حسناتهم وسيئاتهم", "الملائكة المراقبون للجنة والنار", "أنبياء يشفعون للناس", "كفار لم تصلهم الرسالة"],
        correct: 0
    }
],
             
21: [ // اليوم 21 من رمضان
    {
        question: "من الصحابي الذي كان أول من أضاء المساجد بالقناديل في شهر رمضان؟",
        options: ["عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب", "معاوية بن أبي سفيان"],
        correct: 0
    },
    {
        question: "ما اسم الغزوة التي وقعت في 20 رمضان من السنة الثامنة للهجرة؟",
        options: ["غزوة بدر", "غزوة أحد", "غزوة الخندق", "غزوة فتح مكة"],
        correct: 3
    },
    {
        question: "من أول من جمع الناس على صلاة التراويح في المسجد خلف إمام واحد؟",
        options: ["أبو بكر الصديق", "عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب"],
        correct: 1
    },
    {
        question: "من الصحابي الذي أشار على النبي صلى الله عليه وسلم بحفر الخندق في غزوة الأحزاب؟",
        options: [" سعد بن أبي وقاص", "أبو ذر الغفاري", "سلمان الفارسي", "الزبير بن العوام"],
        correct: 2
    },
    {
        question: "ما هي الصلاة التي صلّاها النبي صلى الله عليه وسلم بالأنبياء في ليلة الإسراء والمعراج؟",
        options: ["صلاة المغرب", "صلاة ركعتين إماماً بالأنبياء", "صلاة الفجر", "صلاة العشاء"],
        correct: 1
    }
],


            
            
            22: [ // اليوم 22 من رمضان
                {
                    question: "كم عدد سور القرآن الكريم؟",
                    options: ["112", "114", "116", "110"],
                    correct: 1
                },
                {
                    question: "ما اسم النبي الذي أنزل الله عليه الإنجيل؟",
                    options: ["عيسى عليه السلام", "موسى عليه السلام", "نوح عليه السلام", "إبراهيم عليه السلام"],
                    correct: 0
                },
                {
                    question: "في أي شهر نزل القرآن على النبي محمد صلى الله عليه وسلم؟",
                    options: ["رمضان", "شوال", "ذو القعدة", "محرم"],
                    correct: 0
                },
                {
                    question: "من هو النبي الذي بنى الكعبة مع ابنه إسماعيل عليهما السلام؟",
                    options: ["إبراهيم عليه السلام", "نوح عليه السلام", "موسى عليه السلام", "عيسى عليه السلام"],
                    correct: 0
                },
                {
                                        question: "أي مدينة قديمة تقع في بلاد الرافدين وتشتهر بتاريخها؟",
                    options: ["بغداد", "بابل", "الكوفة", "دمشق"],
                    correct: 1
                }
            ],
            23: [ // اليوم 23 من رمضان
                {
                    question: "من هو الخليفة الذي جمع القرآن في مصحفٍ واحد؟",
                    options: ["عمر بن الخطاب", "عثمان بن عفان", "أبو بكر الصديق", "علي بن أبي طالب"],
                    correct: 1
                },
                {
                    question: "ما هي قبلة المسلمين في الصلاة؟",
                    options: ["المسجد الأقصى", "الكعبة", "الجامع الأموي", "المسجد النبوي"],
                    correct: 1
                },
                {
                    question: "من هو النبي الذي أمر بذبح ابنه كفداءٍ في قصةٍ مشهورة؟",
                    options: ["إسحاق", "إسماعيل", "يعقوب", "يوسف"],
                    correct: 1
                },
                {
                    question: "ما اسم المدينة التي أسسها النبي محمد صلى الله عليه وسلم بعد الهجرة؟",
                    options: ["مكة", "المدينة المنورة", "الطائف", "دمشق"],
                    correct: 1
                },
                {
                    question: "أي من الصحابة كان مشهورًا برواية الأحاديث وقيل عنه 'حبر الأمة'؟",
                    options: ["أبو هريرة", "عبد الله بن مسعود", "سلمان الفارسي", "معاذ بن جبل"],
                    correct: 0
                }
            ],
            24: [ // اليوم 24 من رمضان
                {
                    question: "ما هي أول آية نزلت من القرآن الكريم؟",
                    options: ["اقرأ باسم ربك", "الحمد لله رب العالمين", "لا إله إلا الله", "والله المستعان"],
                    correct: 0
                },
                {
                    question: "من هو النبي الذي أنقذه الله من فرعون بأمرٍ من خلال البحر الأحمر؟",
                    options: ["موسى عليه السلام", "هارون عليه السلام", "إبراهيم عليه السلام", "نوح عليه السلام"],
                    correct: 0
                },
                {
                    question: "ما هو الركن الثاني من أركان الإسلام بعد الشهادتين؟",
                    options: ["الصلاة", "الزكاة", "الصوم", "الحج"],
                    correct: 0
                },
                {
                    question: "وفقًا للإنجيل، في أي مدينة وُلد عيسى عليه السلام؟",
                    options: ["الناصرة", "بيت لحم", "القدس", "روما"],
                    correct: 1
                },
                {
                    question: "من هو الرسول الذي بُعث لبني إسرائيل وفقًا للتوراة؟",
                    options: ["موسى عليه السلام", "عيسى عليه السلام", "إبراهيم عليه السلام", "نوح عليه السلام"],
                    correct: 0
                }
            ],
            25: [ // اليوم 25 من رمضان
                {
                    question: "ما هو الكتاب المقدس في الديانة اليهودية؟",
                    options: ["الإنجيل", "القرآن", "التوراة", "الزبور"],
                    correct: 2
                },
                {
                    question: "أي من الصحابة كان معروفًا بذكائه وبلاغته في فهم الدين؟",
                    options: ["عبد الله بن عباس", "سلمان الفارسي", "سعد بن معاذ", "بلال بن رباح"],
                    correct: 0
                },
                {
                    question: "ما هي عاصمة الدولة الأموية؟",
                    options: ["بغداد", "دمشق", "القاهرة", "الكوفة"],
                    correct: 1
                },
                {
                    question: "من هو الخليفة العباسي الذي عُرف بدعمه للعلوم وتطوير الإدارة؟",
                    options: ["أبو العباس السفاح", "هارون الرشيد", "المتوكل", "المأمون"],
                    correct: 1
                },
                {
                    question: "في عهد أي دولة انتقلت العاصمة الإسلامية إلى بغداد؟",
                    options: ["الدولة الأموية", "الدولة العباسية", "الدولة الفاطمية", "الدولة العثمانية"],
                    correct: 1
                }
            ],
            26: [ // اليوم 26 من رمضان
                {
                    question: "ما هي أطول سورة في القرآن الكريم؟",
                    options: ["سورة آل عمران", "سورة النساء", "سورة البقرة", "سورة الإسراء"],
                    correct: 2
                },
                {
                    question: "من هو الصحابي الذي لُقّب بـ 'ذو النورين'؟",
                    options: ["عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب", "أبو بكر الصديق"],
                    correct: 1
                },
                {
                    question: "ما اسم النبي الذي تحدى النار واستجاب الله لدعائه في قصته؟",
                    options: ["موسى عليه السلام", "إبراهيم عليه السلام", "نوح عليه السلام", "عيسى عليه السلام"],
                    correct: 1
                },
                {
                    question: "ما اسم المعركة التي دارت بين المسلمين والروم في عهد النبي محمد صلى الله عليه وسلم؟",
                    options: ["معركة اليرموك", "معركة صفين", "معركة مؤتة", "معركة حطين"],
                    correct: 2
                },
                {
                    question: "من هو الصحابي الذي لُقِّب بـ أسد الله وأسد رسوله، وكان أحد أعمام النبي ﷺ واستشهد في غزوة أحد؟",
                    options: ["حمزة بن عبدالمطلب", "سعد بن أبي وقاص", "خالد بن الوليد", "علي بن أبي طالب"],
                    correct: 0
                }
            ],
            27: [ // اليوم 27 من رمضان
                {
                    question: "ما اسم المدينة التي يعتبرها المسلمون 'مدينة الأنبياء'؟",
                    options: ["مكة", "المدينة المنورة", "القدس", "النجف"],
                    correct: 2
                },
                {
                    question: "من هو الخليفة الذي حمل اسم 'المأمون' واشتهر برعايته للعلماء؟",
                    options: ["الخليفة الأموي", "الخليفة العباسي المأمون", "الخليفة الفاطمي", "الخليفة العثماني"],
                    correct: 1
                },
                {
                    question: "ما اسم الحدث الذي شارك فيه النبي محمد صلى الله عليه وسلم وأسفر عن تحرير مكة؟",
                    options: ["بدر", "أحد", "خيبر", "فتح مكة"],
                    correct: 3
                },
                {
                    question: "من هو القائد المسلم الذي تصدر معركة اليرموك ضد البيزنطيين؟",
                    options: ["خالد بن الوليد", "عمرو بن العاص", "سعد بن أبي وقاص", "زيد بن حارثة"],
                    correct: 0
                },
                {
                    question: "ما اسم الواقعة التي حدثت في ليلة الإسراء والمعراج؟",
                    options: ["الإسراء", "المعراج", "الإسراء والمعراج", "نزول الوحي"],
                    correct: 2
                }
            ],
            28: [ // اليوم 28 من رمضان
                {
                    question: "كيف وقعت وفاة الخليفة عمر بن الخطاب؟",
                    options: ["استشهد في معركة قادسية", "استشهد في معركة اليرموك", "استشهد في معركة الهميم", "لم يُستشهد؛ اغتيل أثناء الصلاة"],
                    correct: 3
                },
                {
                    question: "من هو الخليفة الذي أسس نظام ديوان الجند لتنظيم شؤون الجيش؟",
                    options: ["أبو بكر الصديق", "عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب"],
                    correct: 1
                },
                {
                    question: "وفقًا للتقاليد اليهودية، من يُعتبر أول الأنبياء؟",
                    options: ["إبراهيم", "موسى", "يعقوب", "آدم"],
                    correct: 3
                },
                {
                    question: "ما اسم المعبد اليهودي الذي دُمّر في عام 70 ميلادي؟",
                    options: ["الهيكل الأول", "الهيكل الثاني", "الكنسية القديمة", "قصر هيرود"],
                    correct: 1
                },
                {
                    question: "ما اسم المعركة التي استعاد فيها صلاح الدين الأيوبي القدس من الصليبيين؟",
                    options: ["معركة حطين", "معركة اليرموك", "معركة عين جالوت", "معركة الزلاقة"],
                    correct: 0
                }
            ],
            29: [ // اليوم 29 من رمضان
                {
                    question: "من هو القائد المسلم الذي أسس دولة الأيوبيين؟",
                    options: ["نور الدين زنكي", "صلاح الدين الأيوبي", "الطاهر بن عاشور", "الظاهر بيبرس"],
                    correct: 1
                },
                {
                    question: "ما اسم القبيلة العربية التي ساعدت النبي محمد صلى الله عليه وسلم عند الهجرة إلى المدينة؟",
                    options: ["قريش", "تميم", "الأنصار", "عتبة"],
                    correct: 2
                },
                {
                    question: "أي من الكتب التالية يُعتبر أصح كتب الحديث عند المسلمين؟",
                    options: ["صحيح البخاري", "صحيح مسلم", "جامع الترمذي", "سنن أبي داود"],
                    correct: 0
                },
                {
                    question: "ما اسم المسجد الذي بُني في القدس في عهد الخليفة عمر بن الخطاب؟",
                    options: ["المسجد الأقصى", "المسجد النبوي", "المسجد الكبير", "مسجد القبلتين"],
                    correct: 0
                },
                {
                    question: "ما اسم المعركة التي وقعت بين المسلمين والفرس في عهد الخليفة عمر بن الخطاب؟",
                    options: ["معركة القادسية", "معركة اليرموك", "معركة القسطنطينية", "معركة نهاوند"],
                    correct: 0
                    }
                ],
            
};

// العناصر
const elements = {
    startScreen: document.getElementById('start-screen'),
    quizScreen: document.getElementById('quiz-screen'),
    resultsScreen: document.getElementById('results-screen'),
    countdownScreen: document.getElementById('countdown-screen'),
    playerNameInput: document.getElementById('player-name'),
    playerEmailInput: document.getElementById('player-email'),
    startButton: document.getElementById('start-button'),
    playerWelcome: document.getElementById('player-welcome'),
    questionCounter: document.getElementById('question-counter'),
    questionText: document.getElementById('question-text'),
    optionsContainer: document.getElementById('options-container'),
    timer: document.getElementById('timer'),
    timerBar: document.getElementById('timer-bar'),
    outOfTimeScreen: document.getElementById('out-of-time-screen'),
    alreadyParticipatedScreen: document.getElementById('already-participated-screen'),
    loadingScreen: document.getElementById('loading-screen')
};

// حالة اللعبة
const gameState = {
    playerName: "",
    playerEmail: "",
    deviceId: "",
    currentQuestion: 0,
    score: 0,
    answers: [],
    timeLeft: 10,
    timer: null,
    questions: [],
    questionStartTime: null,
    questionTimes: [],
    totalTime: 0,
    isAnswered: false,
    correctAnswers: []
};

// دوال المساعدة
function generateDeviceId() {
    try {
        let deviceId = localStorage.getItem('quizDeviceId');
        if (!deviceId) {
            deviceId = 'device_' + Math.random().toString(36).substring(2, 15) + 
                       Math.random().toString(36).substring(2, 15);
            localStorage.setItem('quizDeviceId', deviceId);
        }
        return deviceId;
    } catch (error) {
        console.error('خطأ في إنشاء معرف الجهاز:', error);
        return 'device_' + Date.now();
    }
}

function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

function getTodayFormatted() {
    const now = new Date();
    const moroccoTime = new Date(now.toLocaleString('en-US', { timeZone: 'Africa/Casablanca' }));
    const day = String(moroccoTime.getDate()).padStart(2, '0');
    const month = String(moroccoTime.getMonth() + 1).padStart(2, '0');
    const year = moroccoTime.getFullYear();
    return `${day}-${month}-${year}`;
}

function updateDateTime() {
    const now = new Date();
    const moroccoTime = new Intl.DateTimeFormat('ar-MA', {
        timeZone: 'Africa/Casablanca',
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    }).format(now);
    
    document.getElementById('day-name').textContent = new Intl.DateTimeFormat('ar', { weekday: 'long' }).format(now);
    document.getElementById('current-date').textContent = moroccoTime;
}

function checkQuizTimeStatus() {
    if (QUIZ_MODE === "always") return { isAvailable: true, message: "المسابقة متاحة الآن!", status: "available" };
    if (QUIZ_MODE === "never") return { isAvailable: false, message: "المسابقة غير متاحة حالياً", status: "unavailable" };

    const now = new Date();
    const moroccoTime = new Date(now.toLocaleString('en-US', { timeZone: 'Africa/Casablanca' }));
    const currentHour = moroccoTime.getHours();
    const currentMinute = moroccoTime.getMinutes();

    const currentTimeInMinutes = currentHour * 60 + currentMinute;
    const startTimeInMinutes = QUIZ_START_HOUR * 60 + QUIZ_START_MINUTE;
    let endTimeInMinutes = QUIZ_END_HOUR * 60 + QUIZ_END_MINUTE;

    if (QUIZ_END_HOUR < QUIZ_START_HOUR) {
        endTimeInMinutes += 24 * 60;
    }

    let currentTimeAdjusted = currentTimeInMinutes;
    if (currentTimeInMinutes < startTimeInMinutes && QUIZ_END_HOUR < QUIZ_START_HOUR) {
        currentTimeAdjusted += 24 * 60;
    }

    const isAvailable = currentTimeAdjusted >= startTimeInMinutes && currentTimeAdjusted < endTimeInMinutes;
    
    if (isAvailable) {
        return {
            isAvailable: true,
            message: "المسابقة متاحة الآن!",
            status: "available"
        };
    }

    // حساب الوقت المتبقي للمسابقة القادمة
    let nextStartTime;
    if (currentTimeInMinutes < startTimeInMinutes) {
        nextStartTime = startTimeInMinutes - currentTimeInMinutes;
    } else {
        nextStartTime = (24 * 60 + startTimeInMinutes) - currentTimeInMinutes;
    }

    const hoursRemaining = Math.floor(nextStartTime / 60);
    const minutesRemaining = nextStartTime % 60;

    const timeMessage = `المسابقة ستبدأ بعد ${hoursRemaining} ساعة و ${minutesRemaining} دقيقة`;

    return {
        isAvailable: false,
        message: timeMessage,
        status: "upcoming"
    };
}

// دوال المسابقة الرئيسية
async function initializeQuiz() {
    try {
        elements.loadingScreen.classList.remove('hidden');
        
        const firebaseInitialized = await initializeFirebase();
        gameState.deviceId = generateDeviceId();
        
        updateDateTime();
        setInterval(updateDateTime, 60000);
        
        const quizTimeStatus = checkQuizTimeStatus();
        
        if (quizTimeStatus.isAvailable) {
            let hasParticipated = false;
            
            if (firebaseInitialized) {
                hasParticipated = await checkFirestoreParticipation(gameState.deviceId);
            } else {
                hasParticipated = checkLocalParticipation();
            }
            
            elements.loadingScreen.classList.add('hidden');
            
            if (hasParticipated) {
                elements.alreadyParticipatedScreen.classList.remove('hidden');
            } else {
                elements.startScreen.classList.remove('hidden');
            }
        } else {
            elements.loadingScreen.classList.add('hidden');
            elements.outOfTimeScreen.classList.remove('hidden');
            document.getElementById('time-message').textContent = quizTimeStatus.message;
        }
    } catch (error) {
        console.error('خطأ في تهيئة المسابقة:', error);
        elements.loadingScreen.classList.add('hidden');
        alert('حدث خطأ في تحميل المسابقة. يرجى تحديث الصفحة.');
    }
}

async function startQuiz() {
    try {
        elements.startScreen.classList.add('hidden');
        elements.loadingScreen.classList.remove('hidden');
        
        gameState.playerName = elements.playerNameInput.value.trim();
        gameState.playerEmail = elements.playerEmailInput.value.trim();
        
        const today = new Date();
        const currentDay = today.getDate();
        let questionDay = Math.max(15, Math.min(currentDay, 29));
        
        if (!ramadanQuestions[questionDay]) {
            throw new Error('لا توجد أسئلة متاحة لهذا اليوم');
        }
        
        const shuffledData = shuffleQuestions([...ramadanQuestions[questionDay]]);
        gameState.questions = shuffledData.questions;
        gameState.correctAnswers = shuffledData.correctAnswers;
        
        elements.loadingScreen.classList.add('hidden');
        elements.playerWelcome.textContent = `مرحباً ${gameState.playerName}!`;
        
        startCountdown();
    } catch (error) {
        console.error('خطأ في بدء المسابقة:', error);
        elements.loadingScreen.classList.add('hidden');
        alert('حدث خطأ في بدء المسابقة. يرجى المحاولة مرة أخرى.');
    }
}

function startCountdown() {
    const countdownMessages = [
        { number: 5, text: "استعد التحدي سيبدأ! 🔥" },
        { number: 4, text: "ركّز، الفرصة أمامك! 🚀" },
        { number: 3, text: "لحظات للحسم، لا تتردد! ⚡️" },
        { number: 2, text: "كن الأسرع، كن الأذكى! 🏆" },
        { number: 1, text: "الآن… أطلق إبداعك! 🎯" }
    ];

    let currentIndex = 0;
    elements.countdownScreen.classList.remove('hidden');
    
    function updateCountdown() {
        if (currentIndex >= countdownMessages.length) {
            elements.countdownScreen.classList.add('hidden');
            showQuestion();
            return;
        }

        const message = countdownMessages[currentIndex];
        document.getElementById('countdown-number').textContent = message.number;
        document.getElementById('countdown-text').textContent = message.text;

        currentIndex++;
        setTimeout(updateCountdown, 1000);
    }

    updateCountdown();
}

function showQuestion() {
    elements.quizScreen.classList.remove('hidden');
    gameState.isAnswered = false;
    
    const question = gameState.questions[gameState.currentQuestion];
    elements.questionCounter.textContent = `السؤال ${gameState.currentQuestion + 1} من ${gameState.questions.length}`;
    elements.questionText.textContent = question.question;
    
    elements.optionsContainer.innerHTML = question.options.map((option, index) => `
        <button
            onclick="handleAnswer(${index})"
            class="w-full text-right bg-white/5 hover:bg-white/10 border-2 border-green-400/20 p-4 rounded-xl transition-colors"
        >
            ${option}
        </button>
    `).join('');

    gameState.questionStartTime = Date.now();
    startTimer();
}

function handleAnswer(selectedOption) {
    if (gameState.isAnswered) return;
    gameState.isAnswered = true;
    
    clearInterval(gameState.timer);
    
    const answerTime = (Date.now() - gameState.questionStartTime) / 1000;
    gameState.questionTimes.push(answerTime);
    
    const question = gameState.questions[gameState.currentQuestion];
    const isCorrect = selectedOption === question.correct;
    
    let points = 0;
    if (isCorrect) {
        if (answerTime <= 3) points = 100;
        else if (answerTime <= 5) points = 80;
        else if (answerTime <= 7) points = 60;
        else points = 40;
    }
    
    gameState.score += points;
    gameState.totalTime += answerTime;

    const options = elements.optionsContainer.children;
    Array.from(options).forEach(option => {
        option.classList.add('option-disabled');
    });
    
    if (selectedOption >= 0) {
        options[selectedOption].classList.add(isCorrect ? 'option-correct' : 'option-wrong');
    }
    if (!isCorrect) {
        options[question.correct].classList.add('option-correct');
    }

    gameState.answers.push({
        question: question.question,
        selectedAnswer: selectedOption >= 0 ? question.options[selectedOption] : "لم يتم الإجابة",
        correctAnswer: question.options[question.correct],
        isCorrect: isCorrect,
        time: answerTime,
        points: points
    });

    setTimeout(() => {
        if (gameState.currentQuestion < gameState.questions.length - 1) {
            gameState.currentQuestion++;
            showQuestion();
        } else {
            showResults();
        }
    }, 1500);
}

function startTimer() {
    gameState.timeLeft = 10;
    elements.timer.textContent = gameState.timeLeft;
    elements.timerBar.style.width = '100%';
    
    clearInterval(gameState.timer);
    gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        elements.timer.textContent = gameState.timeLeft;
        elements.timerBar.style.width = `${(gameState.timeLeft / 10) * 100}%`;
        
        if (gameState.timeLeft <= 0) {
            clearInterval(gameState.timer);
            handleAnswer(-1);
        }
    }, 1000);
}

async function showResults() {
    try {
        elements.quizScreen.classList.add('hidden');
        elements.resultsScreen.classList.remove('hidden');

        if (db) {
            const resultData = {
                playerName: gameState.playerName,
                playerEmail: gameState.playerEmail,
                deviceId: gameState.deviceId,
                score: gameState.score,
                totalTime: gameState.totalTime,
                answers: gameState.answers,
                date: getTodayFormatted(),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            await db.collection('results').add(resultData);
        }

        document.getElementById('final-name').textContent = `الاسم: ${gameState.playerName}`;
        document.getElementById('final-score').textContent = 
            `النقاط: ${gameState.score}\nالوقت الإجمالي: ${gameState.totalTime.toFixed(2)} ثانية`;

        const answersHtml = gameState.answers.map((answer, index) => `
            <div class="bg-white/5 p-4 rounded-xl">
                <div class="font-bold mb-2">السؤال ${index + 1}</div>
                <div class="text-sm opacity-90 mb-2">${answer.question}</div>
                <div class="text-sm ${answer.isCorrect ? 'text-green-400' : 'text-red-400'}">
                    إجابتك: ${answer.selectedAnswer}
                    ${!answer.isCorrect ? `<br>الإجابة الصحيحة: ${answer.correctAnswer}` : ''}
                </div>
                <div class="text-sm mt-2">
                    الوقت: ${answer.time.toFixed(2)} ثانية
                    <br>
                    النقاط: ${answer.points}
                </div>
            </div>
        `).join('');

        document.getElementById('answers-review').innerHTML = answersHtml;
    } catch (error) {
        console.error('خطأ في عرض النتائج:', error);
        alert('حدث خطأ في حفظ النتائج');
    }
}

// تهيئة المسابقة عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', () => {
    try {
        lucide.createIcons();
        elements.playerNameInput.addEventListener('input', () => {
            const playerName = elements.playerNameInput.value.trim();
            elements.startButton.disabled = playerName.length < 3;
            elements.startButton.classList.toggle('opacity-50', playerName.length < 3);
        });
        elements.startButton.addEventListener('click', startQuiz);
        initializeQuiz();
    } catch (error) {
        console.error('خطأ في تهيئة الصفحة:', error);
    }
});

// تعريف handleAnswer في النطاق العام
window.handleAnswer = handleAnswer;
</script>
</body>
</html>
